@model Frontend_12102025.Models.ViewModel.RegisterVM

@{
    ViewBag.Title = "Đăng ký tài khoản";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles {
    <style>
        .register-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            padding: 40px 0;
        }

        .register-card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            background: white;
        }

        .register-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 30px;
            text-align: center;
        }

            .register-header h2 {
                margin: 0;
                font-weight: 700;
            }

        .register-body {
            padding: 40px;
        }

        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .btn-register {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 40px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

            .btn-register:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            }

        .password-strength {
            height: 5px;
            border-radius: 3px;
            margin-top: 5px;
            transition: all 0.3s;
        }

        .strength-weak {
            background: #dc3545;
            width: 33%;
        }

        .strength-medium {
            background: #ffc107;
            width: 66%;
        }

        .strength-strong {
            background: #28a745;
            width: 100%;
        }

        .validation-icon {
            position: absolute;
            right: 10px;
            top: 38px;
        }

        .input-group-relative {
            position: relative;
        }
    </style>
}

<div class="register-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">
                <div class="register-card">
                    <div class="register-header">
                        <h2><i class="fas fa-user-plus"></i> Đăng ký tài khoản</h2>
                        <p class="mb-0">Tạo tài khoản để mua sắm dễ dàng hơn</p>
                    </div>

                    <div class="register-body">
                        @if (TempData["Message"] != null)
                        {
                            <div class="alert alert-danger alert-dismissible fade show">
                                @TempData["Message"]
                                <button type="button" class="close" data-dismiss="alert">&times;</button>
                            </div>
                        }

                        @using (Html.BeginForm("Register", "Account", FormMethod.Post, new { @class = "needs-validation", id = "registerForm", novalidate = "novalidate" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })

                            <div class="row">
                                @* Username *@
                                <div class="col-md-6">
                                    <div class="form-group input-group-relative">
                                        @Html.LabelFor(m => m.Username, new { @class = "font-weight-bold" })
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            </div>
                                            @Html.TextBoxFor(m => m.Username, new
                                            {
                                                @class = "form-control",
                                                placeholder = "Nhập tên đăng nhập",
                                                id = "txtUsername"
                                            })
                                        </div>
                                        <small id="usernameStatus" class="form-text"></small>
                                        @Html.ValidationMessageFor(m => m.Username, "", new { @class = "text-danger small" })
                                    </div>
                                </div>

                                @* Full Name *@
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(m => m.FullName, new { @class = "font-weight-bold" })
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                                            </div>
                                            @Html.TextBoxFor(m => m.FullName, new
                                            {
                                                @class = "form-control",
                                                placeholder = "Nhập họ và tên"
                                            })
                                        </div>
                                        @Html.ValidationMessageFor(m => m.FullName, "", new { @class = "text-danger small" })
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                @* Email *@
                                <div class="col-md-6">
                                    <div class="form-group input-group-relative">
                                        @Html.LabelFor(m => m.Email, new { @class = "font-weight-bold" })
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                            </div>
                                            @Html.TextBoxFor(m => m.Email, new
                                            {
                                                @class = "form-control",
                                                placeholder = "example@email.com",
                                                type = "email",
                                                id = "txtEmail"
                                            })
                                        </div>
                                        <small id="emailStatus" class="form-text"></small>
                                        @Html.ValidationMessageFor(m => m.Email, "", new { @class = "text-danger small" })
                                    </div>
                                </div>

                                @* Phone *@
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(m => m.Phone, new { @class = "font-weight-bold" })
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                            </div>
                                            @Html.TextBoxFor(m => m.Phone, new
                                            {
                                                @class = "form-control",
                                                placeholder = "0123456789"
                                            })
                                        </div>
                                        @Html.ValidationMessageFor(m => m.Phone, "", new { @class = "text-danger small" })
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                @* Password *@
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(m => m.Password, new { @class = "font-weight-bold" })
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                            </div>
                                            @Html.PasswordFor(m => m.Password, new
                                            {
                                                @class = "form-control",
                                                placeholder = "Nhập mật khẩu",
                                                id = "txtPassword"
                                            })
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div id="passwordStrength" class="password-strength"></div>
                                        <small class="form-text text-muted">
                                            Mật khẩu phải có ít nhất 6 ký tự, bao gồm chữ hoa, chữ thường và số
                                        </small>
                                        @Html.ValidationMessageFor(m => m.Password, "", new { @class = "text-danger small" })
                                    </div>
                                </div>

                                @* Confirm Password *@
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(m => m.ConfirmPassword, new { @class = "font-weight-bold" })
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                            </div>
                                            @Html.PasswordFor(m => m.ConfirmPassword, new
                                            {
                                                @class = "form-control",
                                                placeholder = "Nhập lại mật khẩu",
                                                id = "txtConfirmPassword"
                                            })
                                        </div>
                                        <small id="confirmPasswordStatus" class="form-text"></small>
                                        @Html.ValidationMessageFor(m => m.ConfirmPassword, "", new { @class = "text-danger small" })
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                @* Date of Birth *@
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(m => m.DateOfBirth, new { @class = "font-weight-bold" })
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                            </div>
                                            @Html.TextBoxFor(m => m.DateOfBirth, new
                                            {
                                                @class = "form-control",
                                                type = "date",
                                                max = DateTime.Now.AddYears(-13).ToString("yyyy-MM-dd")
                                            })
                                        </div>
                                        @Html.ValidationMessageFor(m => m.DateOfBirth, "", new { @class = "text-danger small" })
                                    </div>
                                </div>

                                @* Gender *@
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(m => m.Gender, new { @class = "font-weight-bold" })
                                        <div class="mt-2">
                                            <div class="form-check form-check-inline">
                                                @Html.RadioButtonFor(m => m.Gender, "Nam", new { @class = "form-check-input", id = "genderMale" })
                                                <label class="form-check-label" for="genderMale">
                                                    <i class="fas fa-mars text-primary"></i> Nam
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                @Html.RadioButtonFor(m => m.Gender, "Nữ", new { @class = "form-check-input", id = "genderFemale" })
                                                <label class="form-check-label" for="genderFemale">
                                                    <i class="fas fa-venus text-danger"></i> Nữ
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                @Html.RadioButtonFor(m => m.Gender, "Khác", new { @class = "form-check-input", id = "genderOther" })
                                                <label class="form-check-label" for="genderOther">
                                                    <i class="fas fa-transgender text-info"></i> Khác
                                                </label>
                                            </div>
                                        </div>
                                        @Html.ValidationMessageFor(m => m.Gender, "", new { @class = "text-danger small" })
                                    </div>
                                </div>
                            </div>
                            @* Submit Button *@
                            <div class="form-group text-center mt-4">
                                <button type="submit" class="btn btn-primary btn-register btn-lg btn-block">
                                    <i class="fas fa-user-plus"></i> Đăng ký
                                </button>
                            </div>

                            <div class="text-center">
                                <p class="mb-0">
                                    Đã có tài khoản?
                                    @Html.ActionLink("Đăng nhập ngay", "Login", "Account",
                                        new { area = "Customer" },
                                        new { @class = "font-weight-bold" })
                                </p>
                            </div>

                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    @Scripts.Render("~/bundles/jqueryval")

<script>
        $(document).ready(function() {
            // Toggle password visibility
            $('#togglePassword').click(function() {
                var passwordField = $('#txtPassword');
                var icon = $(this).find('i');

                if (passwordField.attr('type') === 'password') {
                    passwordField.attr('type', 'text');
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    passwordField.attr('type', 'password');
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });

            // Password strength checker
            $('#txtPassword').on('keyup', function() {
                var password = $(this).val();
                var strength = 0;
                var strengthBar = $('#passwordStrength');

                if (password.length >= 6) strength++;
                if (password.match(/[a-z]/)) strength++;
                if (password.match(/[A-Z]/)) strength++;
                if (password.match(/[0-9]/)) strength++;
                if (password.match(/[^a-zA-Z0-9]/)) strength++;

                strengthBar.removeClass('strength-weak strength-medium strength-strong');

                if (strength <= 2) {
                    strengthBar.addClass('strength-weak');
                } else if (strength <= 4) {
                    strengthBar.addClass('strength-medium');
                } else {
                    strengthBar.addClass('strength-strong');
                }
            });

            // Confirm password matching
            $('#txtConfirmPassword').on('keyup', function() {
                var password = $('#txtPassword').val();
                var confirmPassword = $(this).val();
                var status = $('#confirmPasswordStatus');

                if (confirmPassword.length > 0) {
                    if (password === confirmPassword) {
                        status.html('<i class="fas fa-check-circle text-success"></i> Mật khẩu khớp')
                            .removeClass('text-danger').addClass('text-success');
                    } else {
                        status.html('<i class="fas fa-times-circle text-danger"></i> Mật khẩu không khớp')
                            .removeClass('text-success').addClass('text-danger');
                    }
                } else {
                    status.html('');
                }
            });

            // Check username availability (AJAX)
            var usernameTimeout;
            $('#txtUsername').on('keyup', function() {
                clearTimeout(usernameTimeout);
                var username = $(this).val();
                var status = $('#usernameStatus');

                if (username.length >= 3) {
                    usernameTimeout = setTimeout(function() {
                        $.ajax({
                            url: '@Url.Action("CheckUsername", "Account")',
                            type: 'GET',
                            data: { username: username },
                            success: function(response) {
                                if (response.available) {
                                    status.html('<i class="fas fa-check-circle text-success"></i> ' + response.message)
                                        .removeClass('text-danger').addClass('text-success');
                                } else {
                                    status.html('<i class="fas fa-times-circle text-danger"></i> ' + response.message)
                                        .removeClass('text-success').addClass('text-danger');
                                }
                            }
                        });
                    }, 500);
                } else {
                    status.html('');
                }
            });

            // Check email availability (AJAX)
            var emailTimeout;
            $('#txtEmail').on('keyup', function() {
                clearTimeout(emailTimeout);
                var email = $(this).val();
                var status = $('#emailStatus');

                if (email.length > 0 && email.includes('@@')) {
                    emailTimeout = setTimeout(function() {
                        $.ajax({
                            url: '@Url.Action("CheckEmail", "Account")',
                            type: 'GET',
                            data: { email: email },
                            success: function(response) {
                                if (response.available) {
                                    status.html('<i class="fas fa-check-circle text-success"></i> ' + response.message)
                                        .removeClass('text-danger').addClass('text-success');
                                } else {
                                    status.html('<i class="fas fa-times-circle text-danger"></i> ' + response.message)
                                        .removeClass('text-success').addClass('text-danger');
                                }
                            }
                        });
                    }, 500);
                } else {
                    status.html('');
                }
            });
        });
</script>
}
